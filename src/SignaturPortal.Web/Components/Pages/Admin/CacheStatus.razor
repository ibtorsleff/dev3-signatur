@page "/admin/cache-status"
@rendermode InteractiveServer
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize]

<PageTitle>Cache Management</PageTitle>

<MudContainer MaxWidth="MaxWidth.Medium" Class="mt-4">
    <MudText Typo="Typo.h4" Class="mb-4">@Localization.GetText("CacheManagement")</MudText>

    <MudPaper Class="pa-4 mb-4" Elevation="2">
        <MudText Typo="Typo.h6" Class="mb-3">Localization Cache</MudText>

        <MudGrid>
            <MudItem xs="6">
                <MudText Typo="Typo.body2" Color="Color.Secondary">Entry Count</MudText>
                <MudText Typo="Typo.h5">@WarmupService.EntryCount</MudText>
            </MudItem>
            <MudItem xs="6">
                <MudText Typo="Typo.body2" Color="Color.Secondary">Last Loaded</MudText>
                <MudText Typo="Typo.h5">
                    @(WarmupService.LastLoadedAt.HasValue
                        ? WarmupService.LastLoadedAt.Value.ToLocalTime().ToString("yyyy-MM-dd HH:mm:ss")
                        : "Never")
                </MudText>
            </MudItem>
        </MudGrid>

        <MudDivider Class="my-3" />

        <MudButton Variant="Variant.Filled"
                   Color="Color.Primary"
                   OnClick="OnReloadCache"
                   Disabled="_isReloading"
                   StartIcon="@Icons.Material.Filled.Refresh">
            @if (_isReloading)
            {
                <MudProgressCircular Size="Size.Small" Indeterminate="true" Class="mr-2" />
                <text>Reloading...</text>
            }
            else
            {
                <text>Reload Cache</text>
            }
        </MudButton>
    </MudPaper>

    @if (_successMessage is not null)
    {
        <MudAlert Severity="Severity.Success" Class="mb-4" ShowCloseIcon="true" CloseIconClicked="() => _successMessage = null">
            @_successMessage
        </MudAlert>
    }

    @if (_errorMessage is not null)
    {
        <MudAlert Severity="Severity.Error" Class="mb-4" ShowCloseIcon="true" CloseIconClicked="() => _errorMessage = null">
            @_errorMessage
        </MudAlert>
    }
</MudContainer>
