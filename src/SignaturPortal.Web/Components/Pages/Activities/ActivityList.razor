@page "/activities"
@page "/activities/{Mode}"
@using SignaturPortal.Application.DTOs
@using SignaturPortal.Domain.Enums
@attribute [Authorize(Policy = "RecruitmentAccess")]

<PageTitle>@_headlineText</PageTitle>

<MudDataGrid T="ActivityListDto"
             @ref="_dataGrid"
             ServerData="LoadServerData"
             Filterable="@_showFilters"
             FilterMode="DataGridFilterMode.ColumnFilterRow"
             SortMode="SortMode.Multiple"
             Hover="true"
             RowClick="OnRowClick"
             RowStyle="cursor: pointer;"
             Class="portal-data-grid">
    <ToolBarContent>
        <MudText Typo="Typo.body1" Style="font-weight:bold; font-size:var(--portal-grid-headline-font-size);">@_headlineText</MudText>
        <MudChip T="string" Size="Size.Small" Variant="Variant.Filled" Color="Color.Default"
                 Style="background:#fff; font-weight:bold; font-size:12px; margin-left:8px;">@_totalCount.ToString()</MudChip>
        <MudSpacer />
        <MudTooltip Text="@(_showFilters ? "Skjul filtre" : "Vis filtre")">
            <MudIconButton Icon="@Icons.Material.Filled.FilterList"
                           Color="@(_showFilters ? Color.Primary : Color.Default)"
                           OnClick="ToggleFilters" />
        </MudTooltip>
    </ToolBarContent>
    <ColGroup>
        <col />                         @* Headline - flexible fill *@
        <col style="width: 110px;" />   @* Journal No *@
        <col style="width: 130px;" />   @* Deadline *@
        <col style="width: 110px;" />   @* Status *@
        <col style="width: 100px;" />   @* Candidates *@
        <col style="width: 120px;" />   @* Created *@
        <col style="width: 48px;" />    @* View action *@
    </ColGroup>
    <Columns>
        <PropertyColumn Property="x => x.Headline" Title="Activity" />
        <PropertyColumn Property="x => x.JournalNo" Title="Journal No" />
        <PropertyColumn Property="x => x.ApplicationDeadline" Title="Deadline">
            <CellTemplate>
                @if (context.Item.ApplicationDeadline.Year >= 9999)
                {
                    <MudText>-</MudText>
                }
                else
                {
                    <MudText>@context.Item.ApplicationDeadline.ToString("yyyy-MM-dd")</MudText>
                }
            </CellTemplate>
        </PropertyColumn>
        <PropertyColumn Property="x => x.StatusName" Title="Status" />
        <PropertyColumn Property="x => x.CandidateCount" Title="Candidates" Filterable="false" />
        <PropertyColumn Property="x => x.CreateDate" Title="Created" Format="yyyy-MM-dd" />
        <TemplateColumn Title="" Sortable="false" Filterable="false">
            <CellTemplate>
                <MudIconButton Icon="@Icons.Material.Filled.Visibility"
                               Size="Size.Small"
                               OnClick="@(() => NavigateToDetail(context.Item.EractivityId))" />
            </CellTemplate>
        </TemplateColumn>
    </Columns>
    <PagerContent>
        <MudDataGridPager T="ActivityListDto" PageSizeOptions="new int[] { 10, 25, 50, 100 }" />
    </PagerContent>
    <NoRecordsContent>
        <MudText>No recruitment activities found.</MudText>
    </NoRecordsContent>
</MudDataGrid>
