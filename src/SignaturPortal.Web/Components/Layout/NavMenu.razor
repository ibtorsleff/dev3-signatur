<nav class="top-menu">
    @* Row 1: Primary navigation with icons *@
    <div class="row-1">
        <div class="top-logo">
            <a href="@_config.PortalUrl">
                <div>@ResolvePortalName()</div>
            </a>
        </div>
        <ul class="menu-items menu-items-left">
            @foreach (var item in _config.Row1Items)
            {
                <li class="@(item.IsSelected ? "selected" : "")">
                    <a href="@item.Url">
                        <div class="icon @item.IconClass">@ResolveLabel(item)</div>
                    </a>
                </li>
            }
        </ul>
        <ul class="menu-items menu-items-right">
            @foreach (var item in _config.Row1RightItems)
            {
                <li>
                    <a href="@item.Url">
                        <div class="icon @item.IconClass">@ResolveLabel(item)</div>
                    </a>
                </li>
            }
        </ul>
    </div>

    @* Row 2: Secondary tabs *@
    <div class="row-2">
        <ul class="menu-items menu-items-left">
            @foreach (var item in _config.Row2Items)
            {
                <li class="@(item.IsSelected ? "selected" : "")">
                    <a href="@item.Url">
                        <div>@ResolveLabel(item)</div>
                    </a>
                </li>
            }
        </ul>
        <ul class="menu-items menu-items-right">
            <li class="user-menu">
                <MudMenu AnchorOrigin="Origin.BottomRight" TransformOrigin="Origin.TopRight"
                         Dense="true" PopoverClass="user-menu-popover"
                         ActivationEvent="@MouseEvent.MouseOver">
                    <ActivatorContent>
                        <div class="user-menu-activator">
                            @if (Session.IsImpersonating)
                            {
                                @(Session.ImpersonatedByFullName ?? Session.UserName)
                                <MudChip T="string" Color="Color.Warning" Size="Size.Small" Variant="Variant.Filled" Class="impersonate-chip">
                                    Optræder som @(Session.FullName ?? Session.UserName)
                                </MudChip>
                                <span @onclick:stopPropagation="true">
                                    <MudSwitch T="bool" Value="@true" ValueChanged="OnImpersonateToggled"
                                               Color="Color.Warning" Size="Size.Small" Class="impersonate-toggle" />
                                </span>
                            }
                            else
                            {
                                @(Session.IsInitialized ? (Session.FullName ?? Session.UserName) : "User")
                            }
                            <img class="user-icon" src="/Responsive/images/responsive/top-menu/user_44x44.png" alt="User" />
                        </div>
                    </ActivatorContent>
                    <ChildContent>
                        @if (!Session.IsImpersonating)
                        {
                            <MudMenuItem Icon="@Icons.Material.Filled.Person"
                                         OnClick="OpenProfileDialogAsync">
                                @Localization.GetText("Profile")
                            </MudMenuItem>
                            @* Change Password — will be a Blazor dialog in a future phase *@
                            <MudMenuItem Icon="@Icons.Material.Filled.Key">
                                @Localization.GetText("ChangePassword")
                            </MudMenuItem>
                            @if (_isInternal)
                            {
                                <MudMenuItem Icon="@Icons.Material.Filled.ManageAccounts"
                                             OnClick="NavigateToImpersonate">
                                    @Localization.GetText("Impersonate")
                                </MudMenuItem>
                            }
                            <MudDivider />
                        }
                        <MudMenuItem Icon="@(_themeState.IsDarkMode ? Icons.Material.Filled.LightMode : Icons.Material.Filled.DarkMode)"
                                     OnClick="ToggleDarkMode">
                            @(_themeState.IsDarkMode ? "Light mode" : "Dark mode")
                        </MudMenuItem>
                        @if (!Session.IsImpersonating)
                        {
                            <MudDivider />
                            <MudMenuItem Icon="@Icons.Material.Filled.Logout"
                                         OnClick="NavigateToLogout">
                                @Localization.GetText("Logout")
                            </MudMenuItem>
                        }
                    </ChildContent>
                </MudMenu>
            </li>
        </ul>
    </div>

    @* Row 3: Tertiary sub-navigation (hidden if empty) *@
    @if (_config.Row3Items.Count > 0)
    {
        <div class="row-3">
            <ul class="menu-items menu-items-left">
                @foreach (var item in _config.Row3Items)
                {
                    <li class="@(item.IsSelected ? "selected" : "")">
                        <a href="@item.Url">
                            <div>@ResolveLabel(item)</div>
                        </a>
                    </li>
                }
            </ul>
        </div>
    }
</nav>
