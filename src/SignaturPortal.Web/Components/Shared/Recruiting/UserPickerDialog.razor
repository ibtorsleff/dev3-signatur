@using SignaturPortal.Application.DTOs
@using SignaturPortal.Application.Interfaces

<MudDialog>
    <TitleContent>
        <MudText Typo="Typo.h6">@Title</MudText>
    </TitleContent>
    <DialogContent>
        <MudStack Spacing="2">
            <MudTextField T="string"
                          @bind-Value="_searchTerm"
                          Label="@Localization.GetText("Search")"
                          Variant="Variant.Outlined"
                          Margin="Margin.Dense"
                          Immediate="true"
                          DebounceInterval="300"
                          OnDebounceIntervalElapsed="OnSearchChangedAsync"
                          Adornment="Adornment.End"
                          AdornmentIcon="@Icons.Material.Filled.Search" />

            @if (_loading)
            {
                <MudProgressLinear Indeterminate="true" Color="Color.Primary" />
            }
            else if (_users.Count == 0 && !string.IsNullOrEmpty(_searchTerm))
            {
                <MudText Typo="Typo.body2" Class="mud-text-secondary">@Localization.GetText("NoResults")</MudText>
            }
            else
            {
                <MudDataGrid T="UserDropdownDto"
                             Items="_users"
                             Dense="true"
                             Hover="true"
                             ReadOnly="true"
                             Bordered="false"
                             RowClick="OnRowClickedAsync"
                             SelectedItem="_selectedUser"
                             RowClassFunc="@((row, _) => row.UserId == _selectedUser?.UserId ? "mud-selected-item" : "")">
                    <Columns>
                        <PropertyColumn Property="x => x.DisplayName" Title="@Localization.GetText("Name")" />
                    </Columns>
                </MudDataGrid>
            }
        </MudStack>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel" Variant="Variant.Outlined">@Localization.GetText("Cancel")</MudButton>
        <MudButton OnClick="SelectUserAsync"
                   Variant="Variant.Filled"
                   Color="Color.Primary"
                   Disabled="_selectedUser == null">@Localization.GetText("Select")</MudButton>
    </DialogActions>
</MudDialog>
