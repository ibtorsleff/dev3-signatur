---
phase: 03.8-client-selector-dropdown-and-create-activity-button-for-non-client-users-on-activitylist
plan: 02
subsystem: ui
tags: [mudblazor, mudselect, mudbutton, client-dropdown, activity-create, toolbar]

# Dependency graph
requires:
  - phase: 03.8-01
    provides: IClientService, ClientDropdownDto, clientIdFilter on GetActivitiesAsync
provides:
  - MudSelect client dropdown in ActivityList toolbar for non-client users
  - MudButton Create Activity with legacy ASPX navigation via YARP
  - Client selection enforcement with snackbar warning
affects: [activity-list-ui, legacy-navigation]

# Tech tracking
tech-stack:
  added: []
  patterns: [MudSelect with ValueChanged for server-side grid reload, conditional toolbar controls based on user role]

key-files:
  created: []
  modified:
    - src/SignaturPortal.Web/Components/Pages/Activities/ActivityList.razor
    - src/SignaturPortal.Web/Components/Pages/Activities/ActivityList.razor.cs

key-decisions:
  - "Client dropdown uses MudSelect with int Value/-1 sentinel for 'All Clients' -- simpler than nullable int with MudSelect"
  - "Create Activity button enforces client selection via snackbar warning for non-client users"
  - "Draft mode navigates to ActivityCreateDraft.aspx, other modes to ActivityCreateEdit.aspx -- matches legacy routing"

patterns-established:
  - "Toolbar conditional controls: @if (!_isClientUser) for role-gated UI, @if (_canCreateActivity) for permission-gated UI"
  - "Legacy navigation pattern: NavigateTo with forceLoad: true for YARP-proxied ASPX pages with query parameters"

# Metrics
duration: 2min
completed: 2026-02-18
---

# Phase 03.8 Plan 02: Client Dropdown and Create Activity Button Summary

**MudSelect client dropdown and MudButton Create Activity in ActivityList toolbar with role/permission gating and legacy ASPX navigation**

## Performance

- **Duration:** 2 min
- **Started:** 2026-02-18T11:24:41Z
- **Completed:** 2026-02-18T11:27:13Z
- **Tasks:** 1
- **Files modified:** 2

## Accomplishments
- Added MudSelect client dropdown to ActivityList toolbar, visible only for non-client users
- Added Create Activity button with permission gating (_canCreateActivity)
- Client selection triggers grid reload with clientIdFilter passed to GetActivitiesAsync
- Create Activity navigates to correct legacy ASPX page (Draft vs Ongoing) via YARP with forceLoad
- Non-client users must select a client before creating (snackbar warning on missing selection)

## Task Commits

Each task was committed atomically:

1. **Task 1: Add client dropdown, create button, and event handlers to ActivityList** - `b270224` (feat)

## Files Created/Modified
- `src/SignaturPortal.Web/Components/Pages/Activities/ActivityList.razor` - Added MudSelect client dropdown and MudButton Create Activity in ToolBarContent
- `src/SignaturPortal.Web/Components/Pages/Activities/ActivityList.razor.cs` - Added IClientService injection, client state fields, OnClientChanged, OnCreateActivityClick handlers, clientIdFilter in LoadServerData

## Decisions Made
- Used -1 sentinel value for "All Clients" in MudSelect (simpler than nullable int handling with MudBlazor select)
- Create button text varies by mode via computed _createButtonText property (ERCreateNewDraftActivity vs CreateNewActivity)
- Client loading happens once in OnInitializedAsync (not on every mode change)

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered
- Web project build fails due to file locks from running SignaturPortal.Web.exe and devenv.exe processes -- verified compilation via Infrastructure project build (zero errors) and confirmed no CS/RZ compilation errors in Web project output

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness
- ActivityList UI feature complete: client dropdown, create button, permission gating, legacy navigation
- Phase 03.8 fully complete (both plans delivered)
- Ready for visual verification and next phase

---
*Phase: 03.8-client-selector-dropdown-and-create-activity-button-for-non-client-users-on-activitylist*
*Completed: 2026-02-18*
