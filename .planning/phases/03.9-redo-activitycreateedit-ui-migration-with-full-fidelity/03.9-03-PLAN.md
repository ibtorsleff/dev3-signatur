---
phase: 03.9-redo-activitycreateedit-ui-migration-with-full-fidelity
plan: 03
type: execute
wave: 3
depends_on: [03.9-02]
files_modified:
  - src/SignaturPortal.Web/Components/Pages/Recruiting/ActivityCreateEdit.razor.css
autonomous: false
requirements: [CRUD-01, CRUD-04, CRUD-05, CRUD-06]
must_haves:
  truths:
    - "The form renders correctly on desktop: labels and inputs side-by-side in two columns"
    - "The form renders correctly on mobile: single-column stacked layout at 767px breakpoint"
    - "Cascade loading state shows visually disabled inputs (Disabled on MudSelect/MudAutocomplete)"
    - "No [key] bracket-notation placeholders appear for any form field label"
    - "Create flow: navigate to /new, fill required fields, submit → activity created, redirected to /edit URL"
    - "Edit flow: navigate to /{id}/edit → all fields pre-populated including RecruitmentTypeId"
    - "Delete: confirm dialog → activity deleted → navigate to /recruiting/activities"
    - "Close Activity: confirm dialog → activity closed → navigate to /recruiting/activities"
    - "Cancel (edit mode): navigate to /recruiting/activities/{id}"
    - "Cancel (create mode): navigate to /recruiting/activities"
  artifacts:
    - path: "src/SignaturPortal.Web/Components/Pages/Recruiting/ActivityCreateEdit.razor.css"
      provides: "Scoped CSS with cascade loading visual state and mobile responsive layout"
      contains: "max-width: 767px"
  key_links:
    - from: "ActivityCreateEdit.razor.css"
      to: ".activity-form .mud-input-control"
      via: "HeadContent style injection (already in razor, CSS file supplements)"
      pattern: "form-field|field-label-text"
---

<objective>
Polish the ActivityCreateEdit.razor.css to add a cascade loading visual indicator and verify the complete create/edit/delete/cancel flows work end-to-end in the browser.

Purpose: After the code-behind and markup defects are fixed in Plans 01 and 02, a human verification pass is needed to confirm the full form lifecycle works correctly. The CSS needs a minor addition to visually indicate cascade loading state. This plan captures the final verification gate.

Output: Polished CSS and a human-verified working form.
</objective>

<execution_context>
@C:/Users/it/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/it/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/research/ActivityCreateEditMigration.md
@src/SignaturPortal.Web/Components/Pages/Recruiting/ActivityCreateEdit.razor.css
@.planning/phases/03.9-redo-activitycreateedit-ui-migration-with-full-fidelity/03.9-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update ActivityCreateEdit.razor.css — cascade loading visual state</name>
  <files>src/SignaturPortal.Web/Components/Pages/Recruiting/ActivityCreateEdit.razor.css</files>
  <action>
Read the existing CSS file. The current file has correct base styles (form-field, field-label-text, required-mark, form-field-checkbox, checkbox-label-text, mobile media query). It is largely correct and only needs a small addition.

Add a CSS rule for the cascade loading visual indicator. When MudBlazor inputs are `Disabled`, they render with `mud-input-disabled` class and reduced opacity by default. No additional CSS is strictly needed for the disabled state — MudBlazor handles that. However, add a `.cascade-loading-overlay` helper class that can optionally be used by the executor if they want a loading message above the templates section:

```css
/* ── Cascade loading state ── */
/* MudBlazor's Disabled prop adds mud-input-disabled automatically.
   This wrapper class provides optional visual grouping for cascade-loading sections. */
.cascade-loading {
    opacity: 0.6;
    pointer-events: none;
    transition: opacity 0.15s ease;
}
```

Also add an explicit sidebar section spacing rule to ensure the sidebar cards stack cleanly at all widths:
```css
/* ── Sidebar spacing ── */
.sidebar-card {
    margin-bottom: 16px;
}
```

The existing mobile media query (`@media (max-width: 767px)`) should already cover responsive behavior since MudGrid with xs/md breakpoints handles the layout. Confirm the existing rules are present and correct. No changes to the existing rules needed.

After adding the two new rules, run a build to confirm the file does not cause CSS parse errors (though scoped CSS is processed by the Blazor build, not at runtime).
  </action>
  <verify>
    <automated>cd "C:/Users/it/Documents/Dev/CustomersAndProjects/Signatur/Dev3" && dotnet build src/SignaturPortal.Web/SignaturPortal.Web.csproj --no-restore -q 2>&1 | tail -5</automated>
    <manual>Confirm ActivityCreateEdit.razor.css contains .cascade-loading rule</manual>
  </verify>
  <done>Web project builds with zero errors; ActivityCreateEdit.razor.css has .cascade-loading CSS rule</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Human verification — end-to-end form lifecycle</name>
  <action>Human verifies the complete form lifecycle in the browser per the how-to-verify steps below.</action>
  <what-built>
Complete ActivityCreateEdit form fix across Plans 01-03:
- razor.cs: post-edit-save navigates to /recruiting/activities; MapEditDataToForm translates RecruitmentTypeId from LeadershipPositionId/BlindRecruitmentId and derives calendar checkbox state from CalendarTypeId; BuildSaveCommand translates RecruitmentTypeId back to LeadershipPositionId/BlindRecruitmentId; _cascadeLoading bool gates cascade reload
- razor: removed duplicate LeadershipPosition/BlindRecruitment dropdowns; fixed LockCandidateEvaluation key to HideCandidateEvalutionAndNotesWhenUserHasNotEvaluated; cascade Disabled states on all client-dependent template fields
- ActivityFormModel.Validate() uses localized messages via ValidationContext
  </what-built>
  <how-to-verify>
Start the application (dotnet run from SignaturPortal.Web directory or use existing dev server). Log in as a non-client internal user.

**Test 1 — Create flow:**
1. Navigate to `/recruiting/activities/new`
2. Verify: empty form loads, all required dropdowns (Status, RecruitmentType, ApplicationTemplate, email templates) are populated
3. Select a client from the autocomplete — verify cascade loading disables template inputs briefly
4. Fill all required fields (Status, Client, Headline, ClientSection, RecruitmentType, ApplicationTemplate, email templates, Recruitment Responsible)
5. Submit → verify redirect to `/recruiting/activities/{newId}/edit`

**Test 2 — Edit flow:**
1. Navigate to `/recruiting/activities/{existingId}/edit`
2. Verify: all fields pre-populated including a single RecruitmentType dropdown (NOT separate Leadership/BlindRecruitment dropdowns)
3. Verify Row 2 tabs show Activity (selected), Candidates, Advertisement, Notes
4. Make a change (e.g., update Headline)
5. Submit → verify redirect to `/recruiting/activities` (activity list, NOT stays on edit page)

**Test 3 — Delete:**
1. Navigate to `/recruiting/activities/{existingId}/edit`
2. Click Delete → confirm dialog appears with localized text
3. Confirm → verify redirect to `/recruiting/activities`

**Test 4 — Cancel:**
1. Navigate to `/recruiting/activities/{existingId}/edit`
2. Click Cancel → verify redirect to `/recruiting/activities/{id}` (activity detail)
3. Navigate to `/recruiting/activities/new`
4. Click Cancel → verify redirect to `/recruiting/activities` (activity list)

**Test 5 — Validation:**
1. Navigate to `/recruiting/activities/new`, select a client
2. Submit without filling required fields → inline validation messages appear
3. Check: ApplicationDeadline error message is not hardcoded English (should be in Danish if localized, or [ApplicationDeadlineMandatory] if key missing — either is acceptable for this phase)

**Test 6 — Mobile responsive:**
1. Resize browser to < 767px width
2. Verify form stacks to single column (left column + right sidebar stack vertically)
  </how-to-verify>
  <resume-signal>Type "approved" if all 6 tests pass, or describe specific issues found (include which test number failed and what was observed)</resume-signal>
</task>

</tasks>

<verification>
Build succeeds. Human verification checkpoint passes (all 6 test scenarios confirmed working).
</verification>

<success_criteria>
- Web project builds with zero errors
- All 17 checklist items from ActivityCreateEditMigration.md verified (Tests 1-6 cover items 1-9, 13-16)
- Post-edit-save navigation confirmed working (stays-on-page defect resolved)
- RecruitmentType: single dropdown (not 3 dropdowns) confirmed
- Cascade loading Disabled states visible during client change
- Mobile single-column layout confirmed at < 767px
</success_criteria>

<output>
After completion, create `.planning/phases/03.9-redo-activitycreateedit-ui-migration-with-full-fidelity/03.9-03-SUMMARY.md`
</output>
