---
phase: 03.9-redo-activitycreateedit-ui-migration-with-full-fidelity
task: human-verify (03.9-03 Task 2 - more issues found during Skanderborg verification)
status: in_progress
last_updated: 2026-02-23T20:36:41.613Z
---

<current_state>
Skanderborg kommune re-verification found 3 more issues. All previous fixes are committed (61743a1). These 3 fixes are NOT yet implemented — this is where to start next session.
</current_state>

<completed_work>

All previously committed (ddfb9ca + 61743a1):
- RecruitmentType conditional UI (3 client XML flags)
- SendDailyStatusMail: XML → ERecruitmentSendDailyStatusMailToRecruitmentCommitteeEnabled DB column
- InterviewRounds: XML → ERecruitmentMultipleInterviewRoundsEnabled DB column + edit-mode fallback
- ExtendedEvaluation: XML → DB columns + prerequisite CandidateEvaluationEnabled
- HireDate: removed NoHireDate (0) option; default = 1 (Date)

</completed_work>

<remaining_work>

**3 new issues found during Skanderborg verification — NOT YET IMPLEMENTED:**

### Issue 1: Samtalerunde (InterviewRounds) dropdown items wrong
Legacy uses localization:
- Value=1: GetText("RoundWithArgs", "1")   → e.g. "1 runde"
- Value=2-5: GetText("RoundsWithArgs", "N") → e.g. "2 runder"
Items are hardcoded 1-5 (five items, not however many are in the current Blazor _options.InterviewRoundsOptions).

Fix needed:
- ErActivityService.GetActivityFormOptionsAsync: replace DB-sourced InterviewRoundsOptions with 5 hardcoded items
- Items must be localized: call ILocalizationService (or pass localized names in)
- OR: pass localization keys as the Name and resolve in razor (simpler)
- Best approach: resolve in razor using Localization.GetText with format args

The GetText with args pattern — need to check how ILocalizationService handles format args (does it support them?). The legacy uses GetText("RoundWithArgs", "1") which substitutes "1" into the localized string. Check ILocalizationService for an overload with args, or add one.

### Issue 2: SendDailyStatusMail wrong default
Legacy default is TRUE (on) unless XML has @SendDailyStatusMailToRecruitmentCommitteeDefaultOn = 'false'.

Logic (from ClientHelper.cs):
```sql
SELECT CAST(0 AS BIT)  -- returns false/null
FROM Sig_Client SCLI
WHERE SCLI.ClientId = {0}
  AND ERecruitmentEnabled = 1
  AND ERecruitmentSendDailyStatusMailToRecruitmentCommitteeEnabled = 1
  AND CustomData.value('(/ClientCustomData/Recruitment/@SendDailyStatusMailToRecruitmentCommitteeDefaultOn)[1]','NVARCHAR(5)') = 'false'
```
Returns NULL (no rows) if not explicitly 'false' → fallback is TRUE.

Fix needed:
- Add SendDailyStatusMailDefaultOn bool to ActivityClientConfigDto
- In SQL: read the inverted flag — default ON unless XML = 'false'
  Simplest SQL: CAST(CASE WHEN sc.CustomData.value('...@SendDailyStatusMailToRecruitmentCommitteeDefaultOn...','NVARCHAR(5)') = 'false' THEN 0 ELSE 1 END AS BIT) AS SendDailyStatusMailDefaultOn
- In LoadCreateModeAsync: if _clientConfig.SendDailyStatusMailEnabled && _clientConfig.SendDailyStatusMailDefaultOn → set _form.SendDailyStatusMail = true

### Issue 3: Status dropdown — too many items + not localized
Legacy uses HelperERecruiting.ERStatusListGet(includeDeleted, isDraftActivity).
- Deleted (StatusId=3) is EXCLUDED unless the current activity IS already deleted
- Items are localized via GetText(status.TextId) where TextId comes from ERActivityStatus DB table

Fix needed:
- Status options query: read from ERActivityStatus table (or Eractivitystatus), get Id + TextId
- Filter: exclude Deleted (id=3) unless IsEditMode && _editData.StatusId == 3
- Localize: use ILocalizationService.GetText(textId) for each status name
- In GetActivityFormOptionsAsync: pass isDeleted flag, or filter in razor

ERActivityStatus table columns likely: Id, Name, TextId, Order
The Blazor code currently probably hardcodes status names from the enum.
Find where statuses are currently populated in ErActivityService.GetActivityFormOptionsAsync.

</remaining_work>

<decisions_made>

- InterviewRounds localization: legacy uses GetText("RoundWithArgs"/"RoundsWithArgs") with substitution
- SendDailyStatusMail default: TRUE by default, FALSE only if XML explicitly = 'false'
- Status dropdown: sourced from ERActivityStatus table with TextId for localization; Deleted excluded unless activity IS deleted

</decisions_made>

<context>
Legacy code investigated. All 3 issues have clear root causes and fixes. The ErActivityService.GetActivityFormOptionsAsync method is where Statuses and InterviewRoundsOptions are built — that's the primary file to change. ActivityClientConfigDto needs SendDailyStatusMailDefaultOn added. LoadCreateModeAsync needs the default-on logic.

Check ILocalizationService interface for format-args support before implementing the RoundWithArgs localization. If no args overload exists, add one or inline the substitution.

The ERActivityStatus table in the DB likely has columns: Id, TextId (localization key), Name, SortOrder or similar.
</context>

<next_action>
1. Read ErActivityService.GetActivityFormOptionsAsync (lines ~1447-1550) to see current status + interviewRounds population
2. Check ILocalizationService for format-args support  
3. Implement the 3 fixes
4. Commit + re-verify Skanderborg
