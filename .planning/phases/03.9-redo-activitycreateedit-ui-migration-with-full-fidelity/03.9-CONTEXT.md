# Phase 3.9: Redo ActivityCreateEdit UI Migration with Full Fidelity - Context

**Gathered:** 2026-02-23
**Status:** Ready for planning

<domain>
## Phase Boundary

Rewrite ActivityCreateEdit.razor, ActivityCreateEdit.razor.cs, and ActivityCreateEdit.razor.css from scratch to achieve full fidelity with the legacy ActivityCreateEdit.aspx. Keep all existing DTOs and service implementations (they are structurally correct). The redo addresses a wrong UI start: incorrect layout/structure, CSS issues that caused functionality to be removed and never re-added.

</domain>

<decisions>
## Implementation Decisions

### Fix Strategy
- **Rewrite scope:** ActivityCreateEdit.razor, ActivityCreateEdit.razor.cs, ActivityCreateEdit.razor.css — all three from scratch
- **Keep as-is:** All DTOs (ActivityFormModel, ActivityFormOptionsDto, ActivityClientConfigDto, ActivitySaveCommand, ActivityEditDto) and all service implementations in ErActivityService and ClientService
- **Blueprint:** Follow `.planning/research/ActivityCreateEditMigration.md` exactly as the implementation spec
- **All controls must be migrated:** Every field, business rule, and localization key from legacy — no omissions
- **Legacy component sequence:** Field order and grouping must match the legacy ASPX page exactly
- **Responsive layout:** Labels and inputs render side-by-side at wider screens, stacked on mobile — matching the legacy two-rendering approach (MudGrid MudItem xs/md breakpoints)

### Missing DB Fields
- **RecruitmentTypeId** — This is a REQUIRED field. Researcher must audit the legacy DB schema and ASPX code to find the correct column name. If missing from the Eractivity entity scaffold, add it to the entity + EF config. Must be fully in scope (blocking).
- **ClosedCalendarEnabled / OpenCalendarEnabled** — Researcher audits the DB. If these don't map to real DB columns, keep the UI checkboxes but mark them as non-persisting (read-only state, known gap). Phasing this is acceptable.
- **LeadershipPositions / BlindRecruitmentOptions** — Hardcoded "Ja"/"Nej" is acceptable for this phase. No change needed.

### Template Cascade
- **Client change cascade:** Reloads all client-dependent options. Show a visible loading/disabled state on affected fields while the async cascade is running.
- **Template group change:** Only reloads ApplicationTemplates (not email/SMS lists). This is intentional — keep current behavior.
- **Template group cascade scope:** Email and SMS template lists are NOT filtered by template group. Only application templates are filtered.

### Save / Navigation
- **After save (edit mode):** Navigate to `/recruiting/activities` (the activity list). Do NOT stay on the edit page.
- **After save (create mode):** Navigate to `/recruiting/activities/{newId}/edit` (matches existing behavior).
- **After Delete:** Navigate to `/recruiting/activities`.
- **After Close Activity:** Navigate to `/recruiting/activities`.
- **Cancel (edit mode):** Navigate to `/recruiting/activities/{id}` (activity detail).
- **Cancel (create mode):** Navigate to `/recruiting/activities`.

### Validation Messages
- Cross-field validation errors (hire date rules, deadline rules) must use DB localization keys via `GetText()` — not hardcoded English.
- Researcher must identify the correct legacy localization keys for all validation error messages.
- `IValidatableObject.Validate()` on ActivityFormModel should call ILocalizationService for error text (or the planner can use constructor injection pattern if needed).

### Claude's Discretion
- Loading skeleton vs. progress linear during initial page load
- Exact CSS class names and spacing values (follow existing ActivityList patterns)
- Whether to use `MudPaper` or `MudCard` for section containers (research doc uses MudCard)
- Error state design for server-side EAN validation alert

</decisions>

<specifics>
## Specific Ideas

- "The legacy page renders controls in two ways: label + input side by side OR label + input stacked depending on screen size — this needs to work the same way in Blazor"
- "Ensure all controls and all business rules, and localization keys are migrated, and that the legacy UI component sequence is followed"
- The research doc `.planning/research/ActivityCreateEditMigration.md` is the authoritative spec — it has exact field order, conditional visibility rules, cascade triggers, localization keys, and the UserPickerDialog spec

</specifics>

<deferred>
## Deferred Ideas

- Localization of LeadershipPosition and BlindRecruitment dropdown labels (Ja/Nej) — future phase
- ClosedCalendarEnabled / OpenCalendarEnabled full persistence — pending DB audit; if columns don't exist this is a follow-up phase
- Info/help tooltips (ⓘ icons with *Info/*InfoFund localization keys) — not explicitly requested for this phase

</deferred>

---

*Phase: 03.9-redo-activitycreateedit-ui-migration-with-full-fidelity*
*Context gathered: 2026-02-23*
