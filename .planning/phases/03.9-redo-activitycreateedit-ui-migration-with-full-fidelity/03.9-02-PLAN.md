---
phase: 03.9-redo-activitycreateedit-ui-migration-with-full-fidelity
plan: 02
type: execute
wave: 2
depends_on: [03.9-01]
files_modified:
  - src/SignaturPortal.Web/Components/Pages/Recruiting/ActivityCreateEdit.razor
autonomous: true
requirements: [CRUD-01, CRUD-04]
must_haves:
  truths:
    - "The LockCandidateEvaluation checkbox uses the correct localization key HideCandidateEvalutionAndNotesWhenUserHasNotEvaluated"
    - "All client-dependent form inputs are disabled (Disabled attribute) while _cascadeLoading is true"
    - "The RecruitmentType dropdown shows only the single RecruitmentTypeId MudSelect — no separate LeadershipPosition and BlindRecruitment dropdowns alongside it"
    - "The Interview 2+ rounds email dropdown uses the correct localization key InterviewEmailTwoPlusRoundsForSelected"
    - "Client-dependent input fields disabled when no client selected (_form.ClientId not set)"
  artifacts:
    - path: "src/SignaturPortal.Web/Components/Pages/Recruiting/ActivityCreateEdit.razor"
      provides: "Corrected markup with fixed localization key, cascade disabled states, and correct RecruitmentType field display"
      contains: "HideCandidateEvalutionAndNotesWhenUserHasNotEvaluated"
  key_links:
    - from: "ActivityCreateEdit.razor LockCandidateEvaluation checkbox"
      to: "ILocalizationService.GetText('HideCandidateEvalutionAndNotesWhenUserHasNotEvaluated')"
      via: "Localization.GetText call in span.checkbox-label-text"
      pattern: "HideCandidateEvalutionAndNotesWhenUserHasNotEvaluated"
    - from: "ActivityCreateEdit.razor client-dependent inputs"
      to: "_cascadeLoading flag"
      via: "Disabled='@(_cascadeLoading || !_form.ClientId.HasValue)'"
      pattern: "_cascadeLoading"
    - from: "ActivityCreateEdit.razor RecruitmentType section"
      to: "_options.RecruitmentTypes"
      via: "single MudSelect bound to _form.RecruitmentTypeId"
      pattern: "RecruitmentTypes"
---

<objective>
Fix the three markup-level defects in ActivityCreateEdit.razor: wrong localization key for LockCandidateEvaluation, missing cascade loading disabled states on client-dependent inputs, and the duplicate Leadership/BlindRecruitment dropdown fields that should be removed (only RecruitmentTypeId dropdown remains).

Purpose: The razor markup has isolated defects that cause incorrect UI behavior — wrong label text appears for a checkbox, inputs are not disabled during async cascade reload causing race conditions, and three dropdowns appear where only one (RecruitmentTypeId) should be shown.

Output: A corrected ActivityCreateEdit.razor with all identified markup defects resolved.
</objective>

<execution_context>
@C:/Users/it/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/it/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/research/ActivityCreateEditMigration.md
@.planning/phases/03.9-redo-activitycreateedit-ui-migration-with-full-fidelity/03.9-CONTEXT.md
@.planning/phases/03.9-redo-activitycreateedit-ui-migration-with-full-fidelity/03.9-RESEARCH.md
@src/SignaturPortal.Web/Components/Pages/Recruiting/ActivityCreateEdit.razor
@.planning/phases/03.9-redo-activitycreateedit-ui-migration-with-full-fidelity/03.9-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix razor markup — localization key, cascade disabled states, RecruitmentType fields</name>
  <files>src/SignaturPortal.Web/Components/Pages/Recruiting/ActivityCreateEdit.razor</files>
  <action>
Apply three targeted fixes to the existing ActivityCreateEdit.razor markup. Read the file first to confirm current state before editing.

**Fix 1 — Wrong localization key for LockCandidateEvaluation (Defect #10 from research):**
Find the checkbox that uses `Localization.GetText("LockCandidateEvaluation")` and change the key to `"HideCandidateEvalutionAndNotesWhenUserHasNotEvaluated"` (note the legacy typo: "Evalution" not "Evaluation" — match exactly).

Current (wrong):
```razor
<span class="checkbox-label-text">@Localization.GetText("LockCandidateEvaluation")</span>
```
Fixed:
```razor
<span class="checkbox-label-text">@Localization.GetText("HideCandidateEvalutionAndNotesWhenUserHasNotEvaluated")</span>
```

**Fix 2 — Remove separate LeadershipPosition and BlindRecruitment dropdowns (Defect #2 from research):**
The research spec confirms that the correct UI shows only the single `RecruitmentTypeId` dropdown (backed by ERRecruitmentType lookup table). Remove the two separate `LeadershipPosition` and `BlindRecruitment` MudSelect items from the master data MudGrid. The `RecruitmentType` MudSelect (bound to `_form.RecruitmentTypeId`) remains.

Find and remove the MudItem block containing the LeadershipPosition MudSelect:
```razor
@* Leadership Position *@
<MudItem xs="12" sm="6">
    <div class="form-field">
        <label class="field-label-text">@Localization.GetText("LeadershipPosition") <span class="required-mark">*</span></label>
        <MudSelect T="int?" @bind-Value="_form.LeadershipPositionId" ... >
            ...
        </MudSelect>
        <ValidationMessage For="@(() => _form.LeadershipPositionId)" />
    </div>
</MudItem>
```

Find and remove the MudItem block containing the BlindRecruitment MudSelect:
```razor
@* Blind Recruitment *@
<MudItem xs="12" sm="6">
    <div class="form-field">
        <label class="field-label-text">@Localization.GetText("BlindRecruitment") <span class="required-mark">*</span></label>
        <MudSelect T="int?" @bind-Value="_form.BlindRecruitmentId" ... >
            ...
        </MudSelect>
        <ValidationMessage For="@(() => _form.BlindRecruitmentId)" />
    </div>
</MudItem>
```

Keep the RecruitmentType MudItem (bound to `_form.RecruitmentTypeId`) exactly as-is.

**Fix 3 — Add cascade loading Disabled states to client-dependent inputs (Defect #8 from research):**
Client-dependent fields must show `Disabled="@(_cascadeLoading || !_form.ClientId.HasValue)"` to prevent interaction during the async reload triggered by client change. Apply this to the following inputs that depend on client selection:

- ClientSection MudAutocomplete: add `Disabled="@(_cascadeLoading || !_form.ClientId.HasValue)"`
- ClientSectionGroup MudSelect (conditional block): add `Disabled="@(_cascadeLoading || !_form.ClientId.HasValue)"`
- TemplateGroup MudSelect (conditional block): add `Disabled="@(_cascadeLoading || !_form.ClientId.HasValue)"`
- ApplicationTemplate MudSelect: add `Disabled="@(_cascadeLoading || !_form.ClientId.HasValue)"`
- All 7 Email template MudSelects (Received, Interview, Interview2Plus, Rejected, RejectedAfterInterview, NotifyCommittee): add `Disabled="@(_cascadeLoading || !_form.ClientId.HasValue)"`
- SMS template MudSelect (conditional block): add `Disabled="@(_cascadeLoading || !_form.ClientId.HasValue)"`

The Client autocomplete itself does NOT get the cascade disabled state (it is the trigger, not a dependent).

**Fix 4 — Fix Interview 2+ rounds email template localization key:**
The current razor uses `"InterviewEmailForSelected2PlusRounds"`. The correct legacy key per ActivityCreateEditMigration.md is `"InterviewEmailTwoPlusRoundsForSelected"`. Update this label text key.

Current:
```razor
<label class="field-label-text">@Localization.GetText("InterviewEmailForSelected2PlusRounds")</label>
```
Fixed:
```razor
<label class="field-label-text">@Localization.GetText("InterviewEmailTwoPlusRoundsForSelected")</label>
```

After making all 4 changes, verify the file compiles by running a build.
  </action>
  <verify>
    <automated>cd "C:/Users/it/Documents/Dev/CustomersAndProjects/Signatur/Dev3" && dotnet build src/SignaturPortal.Web/SignaturPortal.Web.csproj --no-restore -q 2>&1 | tail -10</automated>
    <manual>
1. Confirm "LockCandidateEvaluation" no longer appears in the razor file (only HideCandidateEvalutionAndNotesWhenUserHasNotEvaluated)
2. Confirm LeadershipPositionId and BlindRecruitmentId MudSelect blocks are gone from master data section
3. Confirm _cascadeLoading appears on at least 8 Disabled attributes in the template section
4. Confirm "InterviewEmailTwoPlusRoundsForSelected" is the key used for Interview2Plus email label
    </manual>
  </verify>
  <done>Web project compiles; "HideCandidateEvalutionAndNotesWhenUserHasNotEvaluated" key is used; Leadership/BlindRecruitment standalone dropdowns removed; cascade disabled states applied to all client-dependent template fields; Interview2Plus email key corrected</done>
</task>

</tasks>

<verification>
Run `dotnet build src/SignaturPortal.Web/SignaturPortal.Web.csproj --no-restore -q` — zero errors.

Check ActivityCreateEdit.razor:
- No occurrence of `"LockCandidateEvaluation"` as GetText key (only `"HideCandidateEvalutionAndNotesWhenUserHasNotEvaluated"`)
- No `_form.LeadershipPositionId` or `_form.BlindRecruitmentId` MudSelect in master data section
- `_cascadeLoading` appears in Disabled attributes on template section inputs
- `"InterviewEmailTwoPlusRoundsForSelected"` is the key for the 2+ rounds email label
</verification>

<success_criteria>
- Web project builds with zero errors
- LockCandidateEvaluation checkbox uses correct legacy localization key (with legacy typo "Evalution")
- LeadershipPosition and BlindRecruitment standalone dropdowns removed from master data card
- All client-dependent template inputs have Disabled="@(_cascadeLoading || !_form.ClientId.HasValue)"
- Interview2Plus email template uses correct legacy localization key
</success_criteria>

<output>
After completion, create `.planning/phases/03.9-redo-activitycreateedit-ui-migration-with-full-fidelity/03.9-02-SUMMARY.md`
</output>
