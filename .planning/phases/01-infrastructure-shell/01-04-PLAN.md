---
phase: 01-infrastructure-shell
plan: 04
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - tests/SignaturPortal.Tests/SignaturPortal.Tests.csproj
  - tests/SignaturPortal.Tests/SmokeTests.cs
  - tests/SignaturPortal.E2E/SignaturPortal.E2E.csproj
  - tests/SignaturPortal.E2E/SmokeTests.cs
  - tests/SignaturPortal.E2E/PlaywrightSetup.cs
  - SignaturPortal.sln
autonomous: true

must_haves:
  truths:
    - "TUnit test project compiles and a smoke test passes with dotnet test"
    - "Playwright test project compiles and a smoke test passes (or is marked as skip/pending if no running app)"
    - "Both test projects are part of the solution and build with dotnet build"
  artifacts:
    - path: "tests/SignaturPortal.Tests/SignaturPortal.Tests.csproj"
      provides: "TUnit unit test project referencing Application and Domain"
      contains: "TUnit"
    - path: "tests/SignaturPortal.Tests/SmokeTests.cs"
      provides: "Initial smoke test proving TUnit framework works"
      contains: "[Test]"
    - path: "tests/SignaturPortal.E2E/SignaturPortal.E2E.csproj"
      provides: "Playwright E2E test project"
      contains: "Playwright"
    - path: "tests/SignaturPortal.E2E/SmokeTests.cs"
      provides: "Initial Playwright smoke test"
      contains: "Playwright"
  key_links:
    - from: "tests/SignaturPortal.Tests/SignaturPortal.Tests.csproj"
      to: "src/SignaturPortal.Application/SignaturPortal.Application.csproj"
      via: "ProjectReference"
      pattern: "SignaturPortal\\.Application"
    - from: "tests/SignaturPortal.E2E/SignaturPortal.E2E.csproj"
      to: "Playwright NuGet package"
      via: "PackageReference"
      pattern: "Microsoft\\.Playwright"
---

<objective>
Scaffold TUnit unit test project and Playwright E2E test project with passing smoke tests, establishing the test infrastructure for all subsequent phases.

Purpose: Every phase from this point forward will add tests. Having the test projects scaffolded and verified with smoke tests ensures test infrastructure works before we need it for real tests.
Output: Two test projects (TUnit unit tests, Playwright E2E) in the solution with passing smoke tests.
</objective>

<execution_context>
@C:/Users/it/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/it/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-infrastructure-shell/01-RESEARCH.md
@.planning/phases/01-infrastructure-shell/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold TUnit unit test project with smoke test</name>
  <files>
    tests/SignaturPortal.Tests/SignaturPortal.Tests.csproj
    tests/SignaturPortal.Tests/SmokeTests.cs
    SignaturPortal.sln
  </files>
  <action>
    Create the TUnit unit test project and verify it works:

    1. Check if TUnit template is available:
       ```
       dotnet new list | findstr -i tunit
       ```
       If TUnit template exists, use it: `dotnet new tunit -n SignaturPortal.Tests -o tests/SignaturPortal.Tests`
       If TUnit template is NOT available, create a standard classlib and add TUnit packages manually:
       ```
       dotnet new classlib -n SignaturPortal.Tests -o tests/SignaturPortal.Tests -f net10.0
       dotnet add tests/SignaturPortal.Tests package TUnit
       ```
       (Use the same target framework as the main projects.)

    2. Add the test project to the solution:
       ```
       dotnet sln SignaturPortal.sln add tests/SignaturPortal.Tests
       ```

    3. Add project references so tests can access application and domain code:
       ```
       dotnet add tests/SignaturPortal.Tests reference src/SignaturPortal.Domain
       dotnet add tests/SignaturPortal.Tests reference src/SignaturPortal.Application
       dotnet add tests/SignaturPortal.Tests reference src/SignaturPortal.Infrastructure
       ```

    4. Create SmokeTests.cs:
       ```csharp
       namespace SignaturPortal.Tests;

       /// <summary>
       /// Smoke tests to verify the test framework is operational.
       /// Real unit tests will be added as features are implemented.
       /// </summary>
       public class SmokeTests
       {
           [Test]
           public async Task TestFramework_IsOperational()
           {
               // Verify TUnit assertions work
               await Assert.That(1 + 1).IsEqualTo(2);
           }

           [Test]
           public async Task DomainLayer_CanBeReferenced()
           {
               // Verify we can reference Domain layer types
               // This will reference actual interfaces once they exist
               var type = typeof(SignaturPortal.Domain.Interfaces.IUnitOfWork);
               await Assert.That(type).IsNotNull();
           }
       }
       ```
       NOTE: If Plan 03 has not run yet (IUnitOfWork doesn't exist), simplify the second test to just reference any Domain type or remove it. The key test is TestFramework_IsOperational.

       IMPORTANT: TUnit uses `await Assert.That(...)` syntax, NOT `Assert.AreEqual()` (that's NUnit). If TUnit is unavailable or the version is too new/old, fall back to NUnit or xUnit and note in summary.

    5. Remove any auto-generated Class1.cs from the test project.

    6. Run the tests:
       ```
       dotnet test tests/SignaturPortal.Tests --verbosity normal
       ```
       All tests must pass.
  </action>
  <verify>
    Run `dotnet test tests/SignaturPortal.Tests --verbosity normal`
    Expected output: 1-2 tests passed, 0 failed, 0 skipped
    Run `dotnet build SignaturPortal.sln` -- solution builds with test project included
  </verify>
  <done>TUnit test project compiles, is part of the solution, and all smoke tests pass.</done>
</task>

<task type="auto">
  <name>Task 2: Scaffold Playwright E2E test project with smoke test</name>
  <files>
    tests/SignaturPortal.E2E/SignaturPortal.E2E.csproj
    tests/SignaturPortal.E2E/SmokeTests.cs
    tests/SignaturPortal.E2E/PlaywrightSetup.cs
    SignaturPortal.sln
  </files>
  <action>
    Create the Playwright E2E test project and verify it works:

    1. Create the E2E test project. Playwright officially supports NUnit and MSTest runners. Use NUnit (Playwright's recommended runner for .NET):
       ```
       dotnet new nunit -n SignaturPortal.E2E -o tests/SignaturPortal.E2E -f net10.0
       ```
       (If net10.0 is unavailable, use the same framework as other projects.)

    2. Add Playwright NuGet package:
       ```
       dotnet add tests/SignaturPortal.E2E package Microsoft.Playwright
       dotnet add tests/SignaturPortal.E2E package Microsoft.Playwright.NUnit
       ```
       Use the latest stable version. If the exact package names differ, check with `dotnet package search Microsoft.Playwright`.

    3. Add the E2E project to the solution:
       ```
       dotnet sln SignaturPortal.sln add tests/SignaturPortal.E2E
       ```

    4. Install Playwright browsers:
       ```
       dotnet build tests/SignaturPortal.E2E
       pwsh tests/SignaturPortal.E2E/bin/Debug/net10.0/playwright.ps1 install
       ```
       If `pwsh` is not available, try `powershell` instead.
       If the playwright.ps1 path differs (different framework version), find it in the bin output.

    5. Remove auto-generated UnitTest1.cs from the test project.

    6. Create PlaywrightSetup.cs with base test class:
       ```csharp
       using Microsoft.Playwright;

       namespace SignaturPortal.E2E;

       /// <summary>
       /// Base setup for Playwright E2E tests.
       /// Provides browser instance management.
       /// </summary>
       public class PlaywrightSetup
       {
           /// <summary>
           /// Base URL for the Blazor app under test.
           /// Override via environment variable BLAZOR_BASE_URL.
           /// </summary>
           public static string BaseUrl =>
               Environment.GetEnvironmentVariable("BLAZOR_BASE_URL")
               ?? "https://localhost:5001";
       }
       ```

    7. Create SmokeTests.cs with a Playwright smoke test:
       ```csharp
       using Microsoft.Playwright;
       using Microsoft.Playwright.NUnit;
       using NUnit.Framework;

       namespace SignaturPortal.E2E;

       /// <summary>
       /// Smoke tests to verify Playwright E2E framework is operational.
       /// Real E2E tests will be added as UI features are implemented.
       /// </summary>
       [TestFixture]
       public class SmokeTests : PageTest
       {
           [Test]
           public async Task PlaywrightFramework_IsOperational()
           {
               // Verify Playwright can launch a browser and navigate
               // Uses a public site to avoid dependency on local app running
               await Page.GotoAsync("https://playwright.dev/dotnet/");
               await Expect(Page).ToHaveTitleAsync(new System.Text.RegularExpressions.Regex("Playwright"));
           }

           [Test]
           [Category("RequiresApp")]
           public async Task BlazorApp_ServesHomePage()
           {
               // This test requires the Blazor app to be running.
               // Skip if app is not available.
               try
               {
                   await Page.GotoAsync(PlaywrightSetup.BaseUrl, new()
                   {
                       WaitUntil = WaitUntilState.NetworkIdle,
                       Timeout = 5000
                   });
                   await Expect(Page.Locator("h1")).ToContainTextAsync("SignaturPortal");
               }
               catch (PlaywrightException)
               {
                   Assert.Ignore("Blazor app not running at " + PlaywrightSetup.BaseUrl);
               }
           }
       }
       ```

    NOTES:
    - The first test (PlaywrightFramework_IsOperational) navigates to playwright.dev to verify Playwright works without requiring the local app.
    - The second test (BlazorApp_ServesHomePage) is conditional -- it skips if the app is not running. This prevents CI failures when the app isn't started.
    - Use PageTest base class from Microsoft.Playwright.NUnit for automatic browser lifecycle management.
    - Blazor Server pages load asynchronously. Always use WaitUntil = WaitUntilState.NetworkIdle.
  </action>
  <verify>
    Run `dotnet build tests/SignaturPortal.E2E` -- must compile cleanly.
    Run `dotnet test tests/SignaturPortal.E2E --filter "PlaywrightFramework_IsOperational" --verbosity normal`
    Expected: 1 test passed (navigates to playwright.dev)

    Run `dotnet build SignaturPortal.sln` -- full solution builds with both test projects.
  </verify>
  <done>Playwright E2E test project compiles, is part of the solution, browser automation works (Playwright smoke test passes), and conditional app smoke test exists for when the Blazor app is running.</done>
</task>

</tasks>

<verification>
1. `dotnet build SignaturPortal.sln` compiles all projects including both test projects
2. `dotnet test tests/SignaturPortal.Tests` runs TUnit smoke test(s) -- all pass
3. `dotnet test tests/SignaturPortal.E2E --filter "PlaywrightFramework_IsOperational"` passes
4. Solution has 6 projects total: 4 main + 2 test projects
</verification>

<success_criteria>
- TUnit test project scaffolded with passing smoke test
- Playwright E2E test project scaffolded with passing browser automation smoke test
- Both test projects are in the solution and build with the full solution
- Test infrastructure ready for real tests in subsequent phases
</success_criteria>

<output>
After completion, create `.planning/phases/01-infrastructure-shell/01-04-SUMMARY.md`
</output>
