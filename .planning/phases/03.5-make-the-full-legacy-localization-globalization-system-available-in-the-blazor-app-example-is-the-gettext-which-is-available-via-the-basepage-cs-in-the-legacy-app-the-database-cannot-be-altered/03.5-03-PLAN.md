---
phase: 03.5-localization
plan: 03
type: execute
wave: 2
depends_on: ["03.5-01"]
files_modified:
  - src/SignaturPortal.Web/Components/Services/INavigationConfigService.cs
  - src/SignaturPortal.Web/Components/Services/NavigationConfigService.cs
  - src/SignaturPortal.Web/Components/Layout/NavMenuConfig.cs
  - src/SignaturPortal.Web/Components/Layout/NavMenu.razor.cs
  - src/SignaturPortal.Web/Components/Layout/NavMenu.razor
autonomous: true

must_haves:
  truths:
    - "NavigationConfigService returns localization keys instead of hardcoded Danish strings for all labels"
    - "NavMenu resolves localization keys to display text via ILocalizationService at render time"
    - "Navigation labels display localized text when DB keys exist, or fall back to hardcoded Label when keys are not yet populated (full migration prep)"
    - "NavigationConfigService remains a singleton (stateless, returns keys not resolved text)"
  artifacts:
    - path: "src/SignaturPortal.Web/Components/Services/NavigationConfigService.cs"
      provides: "Localization keys in Label fields instead of hardcoded Danish"
      contains: "LabelKey"
    - path: "src/SignaturPortal.Web/Components/Layout/NavMenu.razor.cs"
      provides: "ILocalizationService injection for resolving nav label keys"
      contains: "ILocalizationService"
  key_links:
    - from: "src/SignaturPortal.Web/Components/Layout/NavMenu.razor"
      to: "ILocalizationService"
      via: "L.GetText(item.LabelKey) in render"
      pattern: "L\\.GetText.*LabelKey"
    - from: "src/SignaturPortal.Web/Components/Services/NavigationConfigService.cs"
      to: "NavMenuItem.LabelKey"
      via: "returns keys"
      pattern: "LabelKey"
---

<objective>
Refactor NavigationConfigService to return localization keys instead of hardcoded Danish strings. The NavMenu component (scoped per Blazor circuit) resolves keys via ILocalizationService at render time.

Purpose: NavigationConfigService is a singleton and cannot inject scoped ILocalizationService. The solution is to have the singleton return keys and let the scoped NavMenu component resolve them. This enables localized navigation labels for all supported languages.
Output: Navigation labels display localized text from the database, with NavigationConfigService remaining a clean singleton.
</objective>

<execution_context>
@C:/Users/it/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/it/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/03.5-make-the-full-legacy-localization-globalization-system-available-in-the-blazor-app-example-is-the-gettext-which-is-available-via-the-basepage-cs-in-the-legacy-app-the-database-cannot-be-altered/03.5-RESEARCH.md
@.planning/phases/03.5-make-the-full-legacy-localization-globalization-system-available-in-the-blazor-app-example-is-the-gettext-which-is-available-via-the-basepage-cs-in-the-legacy-app-the-database-cannot-be-altered/03.5-01-SUMMARY.md
@src/SignaturPortal.Web/Components/Services/NavigationConfigService.cs
@src/SignaturPortal.Web/Components/Services/INavigationConfigService.cs
@src/SignaturPortal.Web/Components/Layout/NavMenu.razor.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add LabelKey to NavMenuItem and refactor NavigationConfigService to use keys</name>
  <files>
    src/SignaturPortal.Web/Components/Layout/NavMenuConfig.cs
    src/SignaturPortal.Web/Components/Services/NavigationConfigService.cs
    src/SignaturPortal.Web/Components/Services/INavigationConfigService.cs
  </files>
  <action>
    **NOTE: This is full app migration prep. ALL localization keys from the database are available via the infrastructure built in Plan 01. Use reasonable English identifier keys as placeholders. The exact legacy keys will be matched during full migration -- this plan proves the GetText infrastructure works with ANY key.**

    1. **Find and update NavMenuConfig.cs** (or the file containing NavMenuItem class). Add a `LabelKey` property alongside the existing `Label`:
       ```csharp
       public class NavMenuItem
       {
           public string Label { get; set; } = string.Empty;     // Keep for backward compat / fallback display
           public string? LabelKey { get; set; }                  // Localization key (when set, takes priority over Label)
           // ... existing properties
       }
       ```
       Also add `PortalNameKey` to NavMenuConfig alongside `PortalName`.

    2. **Update NavigationConfigService.cs** to populate LabelKey with descriptive PascalCase English keys for all nav items. Keep the existing Label as a fallback value (displayed if the localization key returns no translation):
       ```csharp
       // Before:
       new() { Label = "Sagsliste", Url = "/activities", ... }
       // After:
       new() { LabelKey = "NavigationActivityList", Label = "Sagsliste", Url = "/activities", ... }
       ```

       Use these placeholder keys for ALL nav items:
       - Row 1: "NavigationActivityList" (Sagsliste), "NavigationSearch" (Sog), "NavigationJobBank" (Jobbank), "NavigationHelp" (Hjaelp), "NavigationAdmin" (Admin), "NavigationStatistics" (Statistik)
       - Row 1 right: "NavigationEmployeePortal" (Medarbejderportal), "NavigationAdPortal" (Annonceportal)
       - Row 2: "NavigationDraftActivities" (Kladdesager), "NavigationOngoingActivities" (Igangvaerende sager), "NavigationClosedActivities" (Afsluttede sager)
       - PortalNameKey: "NavigationRecruitingPortal" (Rekruttering)

    3. **Keep INavigationConfigService interface unchanged** -- it still returns NavMenuConfig, the LabelKey is just a new optional property on the DTO.
  </action>
  <verify>
    Run `dotnet build src/SignaturPortal.Web` -- must compile.
  </verify>
  <done>
    NavigationConfigService populates LabelKey on all nav items with descriptive PascalCase English keys. Label retained as fallback. Keys will be populated in Localization table during full migration -- this plan ensures GetText infrastructure works with ANY key.
  </done>
</task>

<task type="auto">
  <name>Task 2: Resolve localization keys in NavMenu at render time</name>
  <files>
    src/SignaturPortal.Web/Components/Layout/NavMenu.razor.cs
    src/SignaturPortal.Web/Components/Layout/NavMenu.razor
  </files>
  <action>
    1. **NavMenu.razor.cs** -- Add `[Inject] private ILocalizationService L { get; set; } = default!;` and add the using statement for `SignaturPortal.Application.Interfaces`.

    2. **NavMenu.razor.cs** -- Add a helper method to resolve label text:
       ```csharp
       private string ResolveLabel(NavMenuItem item)
       {
           if (!string.IsNullOrEmpty(item.LabelKey))
           {
               var text = L.GetText(item.LabelKey);
               // If GetText returns the key wrapped in brackets (not found), fall back to Label
               if (!text.StartsWith("["))
                   return text;
           }
           return item.Label;
       }
       ```
       Also add a similar method or inline call for PortalNameKey on NavMenuConfig.

    3. **NavMenu.razor** -- Replace all occurrences of `item.Label` with `ResolveLabel(item)` in the render markup. Also replace any direct use of `_config.PortalName` with the resolved version.

       Specifically update:
       - Row 1 item labels: wherever `item.Label` appears in the Row 1 rendering loop
       - Row 1 right item labels
       - Row 2 tab labels
       - Row 3 sub-tab labels (currently empty, but future-proof)
       - Portal name display
  </action>
  <verify>
    1. Run `dotnet build src/SignaturPortal.Web` -- must compile.
    2. Run the app and verify navigation labels display correctly (same text as before for Danish users, now coming from DB).
    3. Grep for remaining hardcoded Danish in NavigationConfigService: `grep -n "Rekruttering\|Sagsliste\|Kladdesager\|Igangv" src/SignaturPortal.Web/Components/Services/NavigationConfigService.cs` -- these should only appear as Label fallback values, not as the sole source of text.
  </verify>
  <done>
    NavMenu resolves all navigation labels via ILocalizationService.GetText at render time. Labels display correct localized text. NavigationConfigService remains a singleton returning keys. Fallback to hardcoded Label if key not found in DB.
  </done>
</task>

</tasks>

<verification>
1. `dotnet build src/SignaturPortal.Web` compiles
2. Navigation labels render correctly at runtime
3. NavigationConfigService contains LabelKey for every nav item
4. NavMenu.razor uses ResolveLabel() instead of direct item.Label access
</verification>

<success_criteria>
- NavigationConfigService is still a singleton (no scoped dependencies injected)
- All navigation labels come from ILocalizationService.GetText, resolved per-user in NavMenu
- Fallback to hardcoded Label if localization key returns no translation (brackets or key not in DB)
- Full migration prep: infrastructure works with ANY key -- exact legacy key matching deferred to full migration
</success_criteria>

<output>
After completion, create `.planning/phases/03.5-make-the-full-legacy-localization-globalization-system-available-in-the-blazor-app-example-is-the-gettext-which-is-available-via-the-basepage-cs-in-the-legacy-app-the-database-cannot-be-altered/03.5-03-SUMMARY.md`
</output>
