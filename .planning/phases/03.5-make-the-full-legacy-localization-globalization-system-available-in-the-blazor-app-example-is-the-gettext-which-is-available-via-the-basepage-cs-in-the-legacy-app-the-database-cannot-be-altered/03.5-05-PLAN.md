---
phase: 03.5-localization
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - src/SignaturPortal.Web/Components/Layout/NavMenu.razor.cs
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Navigation item labels display bracket notation keys (e.g., [NavigationActivityList]) when no database translation exists"
    - "Portal name displays bracket notation key (e.g., [PortalNameRecruiting]) when no database translation exists"
  artifacts:
    - path: "src/SignaturPortal.Web/Components/Layout/NavMenu.razor.cs"
      provides: "ResolveLabel and ResolvePortalName with correct fallback logic"
      contains: "return text"
  key_links:
    - from: "NavMenu.razor.cs ResolveLabel"
      to: "ILocalizationService.GetText"
      via: "method call"
      pattern: "L\\.GetText"
---

<objective>
Fix inverted fallback logic in NavMenu.razor.cs that suppresses bracket notation for unresolved localization keys.

Purpose: UAT tests 3 and 4 failed because ResolveLabel and ResolvePortalName fall back to hardcoded text when GetText returns bracket notation. The logic should return whatever GetText returns (translated text or bracket notation) and only fall back to the hardcoded label when no LabelKey/PortalNameKey is configured.
Output: NavMenu displays bracket notation keys for all navigation labels and portal name.
</objective>

<execution_context>
@C:/Users/it/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/it/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix ResolveLabel and ResolvePortalName fallback logic</name>
  <files>src/SignaturPortal.Web/Components/Layout/NavMenu.razor.cs</files>
  <action>
In NavMenu.razor.cs, fix both ResolveLabel and ResolvePortalName methods.

Current (broken) logic in both methods:
```csharp
var text = L.GetText(key);
if (!text.StartsWith('['))
    return text;
// falls through to hardcoded label
```

This returns the hardcoded label when GetText produces bracket notation (key not found in DB). The intent of phase 03.5 is that bracket notation IS the desired fallback -- it shows what key needs translating.

Fix both methods to simply return whatever GetText returns when a key is configured. The hardcoded label is only the fallback when no LabelKey/PortalNameKey is set at all:

For ResolveLabel:
```csharp
private string ResolveLabel(NavMenuItem item)
{
    if (!string.IsNullOrEmpty(item.LabelKey))
    {
        return L.GetText(item.LabelKey);
    }
    return item.Label;
}
```

For ResolvePortalName:
```csharp
private string ResolvePortalName()
{
    if (!string.IsNullOrEmpty(_config.PortalNameKey))
    {
        return L.GetText(_config.PortalNameKey);
    }
    return _config.PortalName;
}
```

Remove the bracket-check conditions entirely. The GetText return value (real translation or bracket notation) is always the correct display value when a key is configured.
  </action>
  <verify>
Build the project: `dotnet build src/SignaturPortal.Web/SignaturPortal.Web.csproj`
Verify the methods no longer contain `StartsWith('[')` checks.
  </verify>
  <done>ResolveLabel returns L.GetText(key) directly when LabelKey is set. ResolvePortalName returns L.GetText(key) directly when PortalNameKey is set. No bracket-notation suppression logic remains.</done>
</task>

</tasks>

<verification>
- `dotnet build` succeeds with no errors
- NavMenu.razor.cs contains no `StartsWith('[')` logic
- ResolveLabel returns GetText result directly when LabelKey is non-empty
- ResolvePortalName returns GetText result directly when PortalNameKey is non-empty
</verification>

<success_criteria>
Navigation labels and portal name display bracket notation keys (e.g., [NavigationActivityList], [PortalNameRecruiting]) when no database translations exist, instead of hardcoded Danish text.
</success_criteria>

<output>
After completion, create `.planning/phases/03.5-make-the-full-legacy-localization-globalization-system-available-in-the-blazor-app-example-is-the-gettext-which-is-available-via-the-basepage-cs-in-the-legacy-app-the-database-cannot-be-altered/03.5-05-SUMMARY.md`
</output>
