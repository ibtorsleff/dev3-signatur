---
phase: 03.3-activity-list-conditional-columns
plan: 02
type: execute
wave: 2
depends_on: ["03.3-01"]
files_modified:
  - src/SignaturPortal.Web/Components/Pages/Activities/ActivityList.razor
  - src/SignaturPortal.Web/Components/Pages/Activities/ActivityList.razor.cs
autonomous: false

must_haves:
  truths:
    - "Ongoing mode shows columns: Id, Headline (with candidate count), Deadline, Client Section, Recruiting Responsible, Create Date, Created By, Template Group"
    - "Draft mode shows columns: Id, Headline (no count), Deadline, Client Section, Recruiting Responsible, Create Date, Draft Responsible"
    - "Closed mode shows columns: Id, Headline (with candidate count), Deadline, Client Section, Recruiting Responsible, Create Date, Created By, Template Group"
    - "JournalNo, CandidateCount, StatusName, and View icon columns do not appear in any mode"
    - "Activities with ContinuousPosting=true show a dash instead of a date in the Deadline column"
    - "Headline shows candidate count in parentheses for Ongoing and Closed modes (e.g. 'Title (5)') but not for Draft"
  artifacts:
    - path: "src/SignaturPortal.Web/Components/Pages/Activities/ActivityList.razor"
      provides: "Mode-aware column grid with correct column set per mode"
      min_lines: 50
    - path: "src/SignaturPortal.Web/Components/Pages/Activities/ActivityList.razor.cs"
      provides: "Column visibility computed properties based on _currentStatus"
      contains: "_hideCreatedByColumn"
  key_links:
    - from: "src/SignaturPortal.Web/Components/Pages/Activities/ActivityList.razor"
      to: "ActivityListDto"
      via: "PropertyColumn bindings to expanded DTO fields"
      pattern: "RecruitingResponsibleName|CreatedByName|ClientSectionName"
    - from: "src/SignaturPortal.Web/Components/Pages/Activities/ActivityList.razor"
      to: "code-behind visibility booleans"
      via: "Hidden property bindings"
      pattern: "Hidden.*_hide"
---

<objective>
Replace the incorrect fixed-column activity list grid with mode-aware columns matching the legacy WebForms implementation exactly.

Purpose: The current Blazor grid shows 7 columns, two of which (JournalNo, Candidates) don't exist in legacy, and one (Status) is explicitly hidden in legacy. This plan removes those wrong columns, adds the correct columns (Id, ClientSection, RecruitingResponsible, CreatedBy, DraftResponsible, TemplateGroup), and makes them conditionally visible based on the current mode (Draft/Ongoing/Closed). The Headline column is modified to embed candidate count in parentheses for non-Draft modes.

Output: A Blazor MudDataGrid that shows exactly the same columns as the legacy WebForms activity list for each mode.
</objective>

<execution_context>
@C:/Users/it/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/it/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03.3-activity-list-conditional-columns/03.3-RESEARCH.md
@.planning/phases/03.3-activity-list-conditional-columns/03.3-01-SUMMARY.md
@src/SignaturPortal.Application/DTOs/ActivityListDto.cs
@src/SignaturPortal.Web/Components/Pages/Activities/ActivityList.razor
@src/SignaturPortal.Web/Components/Pages/Activities/ActivityList.razor.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement mode-aware columns in ActivityList grid</name>
  <files>
    src/SignaturPortal.Web/Components/Pages/Activities/ActivityList.razor
    src/SignaturPortal.Web/Components/Pages/Activities/ActivityList.razor.cs
  </files>
  <action>
**ActivityList.razor.cs** -- Add column visibility computed properties based on `_currentStatus`:

```csharp
// Column visibility: computed from current mode
// CreatedBy: visible in Ongoing and Closed, hidden in Draft
private bool _hideCreatedByColumn => _currentStatus == ERActivityStatus.Draft;
// DraftResponsible: visible in Draft only
private bool _hideDraftResponsibleColumn => _currentStatus != ERActivityStatus.Draft;
// TemplateGroup: visible in Ongoing and Closed, hidden in Draft
private bool _hideTemplateGroupColumn => _currentStatus == ERActivityStatus.Draft;
// Whether to show candidate count in Headline
private bool _showCandidateCount => _currentStatus != ERActivityStatus.Draft;
```

**ActivityList.razor** -- Replace the entire `<Columns>` section and `<ColGroup>`. Remove these columns entirely:
- JournalNo (does not exist in legacy)
- StatusName (explicitly hidden in legacy)
- CandidateCount as separate column (count is embedded in Headline)
- View icon TemplateColumn (legacy uses row click, Blazor already has OnRowClick)

Add these columns in legacy order:
1. **Id** (EractivityId) -- `<PropertyColumn Property="x => x.EractivityId" Title="Id" />` (always visible, narrow ~70px)
2. **Headline** -- Use `<TemplateColumn>` with CellTemplate that appends candidate count in parens for Ongoing/Closed:
   ```razor
   <TemplateColumn Title="Headline" SortLabel="Headline">
       <CellTemplate>
           @if (_showCandidateCount && context.Item.CandidateCount > 0)
           {
               @($"{context.Item.Headline} ({context.Item.CandidateCount})")
           }
           else
           {
               @context.Item.Headline
           }
       </CellTemplate>
   </TemplateColumn>
   ```
3. **Application Deadline** -- Keep existing CellTemplate but change the condition from `Year >= 9999` to `ContinuousPosting`:
   ```razor
   <PropertyColumn Property="x => x.ApplicationDeadline" Title="Deadline">
       <CellTemplate>
           @if (context.Item.ContinuousPosting)
           {
               <MudTooltip Text="Continuous Posting">
                   <MudText>-</MudText>
               </MudTooltip>
           }
           else
           {
               <MudText>@context.Item.ApplicationDeadline.ToString("dd-MM-yyyy")</MudText>
           }
       </CellTemplate>
   </PropertyColumn>
   ```
   Note: Date format changed to `dd-MM-yyyy` (Danish format, matching legacy).

4. **Client Section** -- `<PropertyColumn Property="x => x.ClientSectionName" Title="Client Section" />` (always visible)
5. **Recruiting Responsible** -- `<PropertyColumn Property="x => x.RecruitingResponsibleName" Title="Responsible" />` (always visible)
6. **Create Date** -- `<PropertyColumn Property="x => x.CreateDate" Title="Created" Format="dd-MM-yyyy" />` (always visible)
7. **Created By** -- `<PropertyColumn Property="x => x.CreatedByName" Title="Created By" Hidden="@_hideCreatedByColumn" />` (Ongoing + Closed only)
8. **Draft Responsible** -- `<PropertyColumn Property="x => x.DraftResponsibleName" Title="Draft Responsible" Hidden="@_hideDraftResponsibleColumn" />` (Draft only)
9. **Template Group** -- `<PropertyColumn Property="x => x.TemplateGroupName" Title="Template Group" Hidden="@_hideTemplateGroupColumn" />` (Ongoing + Closed only)

Update `<ColGroup>` to match new column set:
```razor
<ColGroup>
    <col style="width: 70px;" />     @* Id *@
    <col />                           @* Headline - flexible fill *@
    <col style="width: 120px;" />    @* Deadline *@
    <col style="width: 150px;" />    @* Client Section *@
    <col style="width: 150px;" />    @* Responsible *@
    <col style="width: 110px;" />    @* Created *@
    <col style="width: 130px;" />    @* Created By / Draft Responsible *@
    <col style="width: 140px;" />    @* Template Group *@
</ColGroup>
```

Important: The `ColGroup` has columns for ALL possible columns including conditionally hidden ones. MudDataGrid handles Hidden columns by not rendering them, so the ColGroup entries for hidden columns are simply unused. This keeps the layout consistent.
  </action>
  <verify>
`dotnet build src/SignaturPortal.Web` compiles without errors. No references to removed DTO fields (JournalNo, StatusName) remain.
  </verify>
  <done>
ActivityList.razor shows the correct column set per mode:
- Ongoing: Id, Headline (count), Deadline, ClientSection, Responsible, Created, CreatedBy, TemplateGroup
- Draft: Id, Headline, Deadline, ClientSection, Responsible, Created, DraftResponsible
- Closed: Id, Headline (count), Deadline, ClientSection, Responsible, Created, CreatedBy, TemplateGroup
JournalNo, CandidateCount, StatusName, View icon columns removed. ContinuousPosting handled.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Visual verification of mode-aware columns</name>
  <action>
Human verifies that the activity list shows the correct columns per mode, matching the legacy WebForms implementation.
  </action>
  <verify>
Human confirms columns match legacy for all 3 modes.
  </verify>
  <done>Visual verification approved.</done>
  <what-built>Mode-aware activity list columns matching legacy WebForms. Different columns visible per mode (Draft/Ongoing/Closed), candidate count embedded in Headline, ContinuousPosting handled in Deadline column.</what-built>
  <how-to-verify>
    1. Start the app: `dotnet run --project src/SignaturPortal.Web`
    2. Navigate to https://localhost:5219/activities (Ongoing mode)
       - Verify columns: Id, Headline (with count in parens), Deadline, Client Section, Responsible, Created, Created By, Template Group
       - Verify NO JournalNo, Status, Candidates, or View icon columns
    3. Navigate to https://localhost:5219/activities/draft
       - Verify columns: Id, Headline (NO count), Deadline, Client Section, Responsible, Created, Draft Responsible
       - Verify Created By and Template Group are HIDDEN
    4. Navigate to https://localhost:5219/activities/closed
       - Verify columns same as Ongoing (Id, Headline with count, Deadline, Client Section, Responsible, Created, Created By, Template Group)
    5. Check if any activity has ContinuousPosting=true -- deadline should show "-" with tooltip
    6. Verify row click still navigates to detail page
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
- `dotnet build src/SignaturPortal.Web` passes with zero errors
- No references to JournalNo, StatusName as column properties in ActivityList.razor
- Column visibility toggles correctly when navigating between /activities, /activities/draft, /activities/closed
- Headline shows "(N)" count for Ongoing/Closed, no count for Draft
- ContinuousPosting activities show "-" instead of a date
</verification>

<success_criteria>
- Each mode (Draft, Ongoing, Closed) shows exactly the same columns as the legacy WebForms version
- JournalNo, CandidateCount (separate column), StatusName, View icon removed
- CreatedBy visible only in Ongoing/Closed
- DraftResponsible visible only in Draft
- TemplateGroup visible only in Ongoing/Closed
- Headline embeds candidate count for Ongoing/Closed
- ContinuousPosting handled correctly
- Human visual verification approved
</success_criteria>

<output>
After completion, create `.planning/phases/03.3-activity-list-conditional-columns/03.3-02-SUMMARY.md`
</output>
