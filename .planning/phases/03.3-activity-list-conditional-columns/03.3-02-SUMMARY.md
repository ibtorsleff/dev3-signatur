---
phase: 03.3-activity-list-conditional-columns
plan: 02
subsystem: ui
tags: [blazor, mudblazor, muddatagrid, conditional-columns, mode-aware]

# Dependency graph
requires:
  - phase: 03.3-activity-list-conditional-columns
    plan: 01
    provides: "ActivityListDto with 5 resolved name fields, ContinuousPosting, ClientSection/ErTemplateGroup entities"
  - phase: 03.2-activity-list-layout-matching
    provides: "Portal grid CSS theming and layout styling"
  - phase: 03.1-route-aware-nav-activity-modes
    provides: "Mode routing and _currentStatus for Draft/Ongoing/Closed"
provides:
  - "Mode-aware MudDataGrid column visibility (Draft/Ongoing/Closed show different column sets)"
  - "Candidate count embedded in Headline for Ongoing/Closed modes"
  - "ContinuousPosting handled with dash in Deadline column"
  - "WebAdVisitor entity and Antal klik (click count) column"
  - "Copy action icon column for Ongoing/Closed modes"
  - "HeaderStyle per column replacing ColGroup (fixes hidden column whitespace)"
affects: [03.4-activity-list-further-refinements, 04-write-operations]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Column visibility via Hidden property bound to computed booleans based on _currentStatus"
    - "HeaderStyle per PropertyColumn instead of ColGroup for correct widths when columns are conditionally hidden"
    - "Candidate count embedded in Headline text rather than separate column (matching legacy)"

key-files:
  created:
    - "src/SignaturPortal.Infrastructure/Data/Entities/WebAdVisitor.cs"
  modified:
    - "src/SignaturPortal.Web/Components/Pages/Activities/ActivityList.razor"
    - "src/SignaturPortal.Web/Components/Pages/Activities/ActivityList.razor.cs"
    - "src/SignaturPortal.Application/DTOs/ActivityListDto.cs"
    - "src/SignaturPortal.Infrastructure/Data/SignaturDbContext.cs"
    - "src/SignaturPortal.Infrastructure/Services/ActivityService.cs"
    - "src/SignaturPortal.Web/wwwroot/css/portal-themes/_grid-base.css"

key-decisions:
  - "HeaderStyle per column instead of ColGroup -- ColGroup leaves whitespace when Hidden columns are toggled off"
  - "Headline as PropertyColumn with Format, not TemplateColumn -- consistent header styling with other columns"
  - "WebAdVisitor entity for click count column (client config currently hardcoded, TODO for proper check)"
  - "Copy action icon served from legacy via YARP (/Responsive/images/responsive/activity-list/)"

patterns-established:
  - "Hidden property pattern: bind Hidden to computed bool that evaluates _currentStatus for mode-aware visibility"
  - "Action icon pattern: TemplateColumn with img tag pointing to legacy-served icons via YARP"

# Metrics
duration: 8min
completed: 2026-02-16
---

# Phase 03.3 Plan 02: Mode-Aware Column Visibility Summary

**MudDataGrid with conditional column sets per mode (Draft/Ongoing/Closed), click count column, copy action icon, and HeaderStyle-based widths replacing ColGroup**

## Performance

- **Duration:** ~8 min (execution) + checkpoint review with additional changes
- **Started:** 2026-02-16T14:59:00Z
- **Completed:** 2026-02-16T16:47:15Z
- **Tasks:** 2
- **Files modified:** 7

## Accomplishments
- Replaced fixed-column grid with mode-aware columns matching legacy WebForms column sets for Draft, Ongoing, and Closed modes
- Removed incorrect columns (JournalNo, StatusName, CandidateCount as separate column, View icon) that did not exist in legacy
- Added correct columns: Id, Headline (with candidate count), Deadline, Client Section, Responsible, Created, Created By, Draft Responsible, Template Group
- Column visibility toggles automatically based on current status mode (CreatedBy/TemplateGroup hidden in Draft, DraftResponsible hidden in Ongoing/Closed)
- ContinuousPosting activities show dash with tooltip instead of date in Deadline column
- Added WebAdVisitor entity and "Antal klik" click count column
- Added copy action icon column for Ongoing and Closed modes
- Replaced ColGroup with HeaderStyle per column to fix whitespace from hidden columns

## Task Commits

Each task was committed atomically:

1. **Task 1: Implement mode-aware columns in ActivityList grid** - `740a016` (feat)
2. **Checkpoint review changes: Visitors column, copy icon, HeaderStyle fix** - `1b14a33` (feat)

## Files Created/Modified
- `src/SignaturPortal.Web/Components/Pages/Activities/ActivityList.razor` - Mode-aware column grid with conditional visibility, HeaderStyle widths, copy icon, click count
- `src/SignaturPortal.Web/Components/Pages/Activities/ActivityList.razor.cs` - Column visibility computed booleans (_hideCreatedByColumn, _hideDraftResponsibleColumn, _hideTemplateGroupColumn, etc.)
- `src/SignaturPortal.Application/DTOs/ActivityListDto.cs` - Added VisitorCount property
- `src/SignaturPortal.Infrastructure/Data/Entities/WebAdVisitor.cs` - New entity for web ad visitor statistics (click tracking)
- `src/SignaturPortal.Infrastructure/Data/SignaturDbContext.cs` - Registered WebAdVisitor DbSet and entity configuration
- `src/SignaturPortal.Infrastructure/Services/ActivityService.cs` - Added visitor count subquery to activity list projection
- `src/SignaturPortal.Web/wwwroot/css/portal-themes/_grid-base.css` - Action icon and copy button styling

## Decisions Made
- Used HeaderStyle per column instead of ColGroup because MudDataGrid ColGroup leaves whitespace when Hidden columns are toggled off by mode changes
- Switched Headline from TemplateColumn to PropertyColumn for consistent header styling across all columns
- WebAdVisitor entity added for click count display (client config check hardcoded as TODO -- proper client configuration lookup deferred)
- Copy action icon served from legacy app via YARP reverse proxy (same pattern as navigation icons)
- Renamed column title back to "Headline" (matching legacy exactly)

## Deviations from Plan

### User-Requested Changes During Checkpoint Review

**1. Added WebAdVisitor entity and "Antal klik" column**
- **Found during:** Task 2 (checkpoint review)
- **Issue:** User identified missing click count column that exists in legacy
- **Fix:** Created WebAdVisitor entity, added VisitorCount to DTO, added subquery in service, added column to grid
- **Files modified:** WebAdVisitor.cs, ActivityListDto.cs, SignaturDbContext.cs, ActivityService.cs, ActivityList.razor, ActivityList.razor.cs

**2. Added copy action icon column**
- **Found during:** Task 2 (checkpoint review)
- **Issue:** User identified missing copy action in legacy Ongoing/Closed views
- **Fix:** Added TemplateColumn with copy icon, hidden in Draft mode
- **Files modified:** ActivityList.razor, ActivityList.razor.cs, _grid-base.css

**3. Replaced ColGroup with HeaderStyle per column**
- **Found during:** Task 2 (checkpoint review)
- **Issue:** ColGroup caused whitespace when Hidden columns were toggled off
- **Fix:** Moved column widths to HeaderStyle property on each PropertyColumn/TemplateColumn
- **Files modified:** ActivityList.razor

**4. Switched Headline to PropertyColumn**
- **Found during:** Task 2 (checkpoint review)
- **Issue:** TemplateColumn had inconsistent header styling compared to other PropertyColumns
- **Fix:** Changed to PropertyColumn for consistent rendering
- **Files modified:** ActivityList.razor

---

**Total deviations:** 4 user-requested changes during checkpoint review
**Impact on plan:** All changes improve legacy fidelity. Committed as separate commit `1b14a33`.

## Issues Encountered

None - both the planned implementation and the checkpoint review changes compiled and rendered correctly.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness
- Activity list now matches legacy WebForms column sets for all 3 modes (Draft, Ongoing, Closed)
- TODOs remain for client configuration checks (WebAdVisitorStatistics, TemplateGroups, copy permission) -- these should be addressed when client config infrastructure is built
- Phase 03.3 is complete -- ready for next phase in roadmap

## Self-Check: PASSED

All 7 files verified present on disk. Both commits (740a016, 1b14a33) verified in git history.

---
*Phase: 03.3-activity-list-conditional-columns*
*Completed: 2026-02-16*
