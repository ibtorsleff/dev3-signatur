---
phase: 03.1-route-aware-nav-activity-modes
plan: 02
subsystem: ui
tags: [blazor, routing, server-side-filtering, MudDataGrid, ERActivityStatus]

# Dependency graph
requires:
  - phase: 03-core-read-views
    provides: "ActivityList page with MudDataGrid, IActivityService, ActivityService"
  - phase: 03.1-route-aware-nav-activity-modes
    plan: 01
    provides: "INavigationConfigService with Row 2 mode tabs for Ongoing/Closed/Draft"
provides:
  - "Mode route parameter on ActivityList (/activities/{Mode})"
  - "Server-side status filtering via ERActivityStatus in GetActivitiesAsync"
  - "Danish mode headlines with live activity count badge"
  - "OnParametersSet-based grid reload on mode navigation"
affects: [phase-4-write-ops, candidate-detail-navigation]

# Tech tracking
tech-stack:
  added: []
  patterns: [route-parameter-based-filtering, OnParametersSet-for-SPA-reuse, server-side-status-filter]

key-files:
  created: []
  modified:
    - src/SignaturPortal.Application/Interfaces/IActivityService.cs
    - src/SignaturPortal.Infrastructure/Services/ActivityService.cs
    - src/SignaturPortal.Web/Components/Pages/Activities/ActivityList.razor
    - src/SignaturPortal.Web/Components/Pages/Activities/ActivityList.razor.cs

key-decisions:
  - "Status filter applied server-side in SQL WHERE clause before count and pagination"
  - "OnParametersSet used instead of OnInitializedAsync for detecting mode changes during SPA navigation"
  - "Default status filter parameter (null) ensures backward compatibility with existing callers"
  - "No route conflict: /activities/{Mode} (string) vs /activities/{ActivityId:int} (constrained)"

patterns-established:
  - "Route parameter filtering: Mode string maps to enum via switch expression, passes to service layer"
  - "Grid reload on param change: OnParametersSet detects status change, calls _dataGrid?.ReloadServerData()"
  - "Count badge pattern: _totalCount updated in LoadServerData, displayed in toolbar headline"

# Metrics
duration: 3min
completed: 2026-02-16
---

# Phase 03.1 Plan 02: Activity List Status Mode Filtering Summary

**Route-parameter-based activity list modes with server-side ERActivityStatus filtering and Danish headlines with count badges**

## Performance

- **Duration:** 3 min
- **Started:** 2026-02-16T10:51:23Z
- **Completed:** 2026-02-16T10:54:00Z
- **Tasks:** 2
- **Files modified:** 4

## Accomplishments
- IActivityService.GetActivitiesAsync accepts optional ERActivityStatus filter, applied as SQL WHERE clause before count/pagination
- ActivityList page supports 3 modes: /activities (Ongoing), /activities/closed (Closed), /activities/draft (Draft)
- Danish headlines with live count: "Igangvaerende sager (42)", "Afsluttede sager (5)", "Kladdesager (3)"
- OnParametersSet detects mode changes during SPA navigation and triggers grid reload without full page refresh
- Browser tab title updates to match the current mode name

## Task Commits

Each task was committed atomically:

1. **Task 1: Add status filter parameter to IActivityService and ActivityService** - `dbe295c` (feat)
2. **Task 2: Add Mode route parameter, headline with count, and filtered data loading** - `0b585ce` (feat)

## Files Created/Modified
- `src/SignaturPortal.Application/Interfaces/IActivityService.cs` - Added ERActivityStatus? statusFilter parameter to GetActivitiesAsync
- `src/SignaturPortal.Infrastructure/Services/ActivityService.cs` - Added server-side WHERE clause for EractivityStatusId filtering
- `src/SignaturPortal.Web/Components/Pages/Activities/ActivityList.razor` - Added @page "/activities/{Mode}", mode-aware headline and PageTitle
- `src/SignaturPortal.Web/Components/Pages/Activities/ActivityList.razor.cs` - Added Mode parameter, OnParametersSet, _currentStatus/_headlineText/_totalCount fields

## Decisions Made
- Status filter applied server-side in SQL WHERE clause (not client-side post-filtering) for correct TotalCount and efficient pagination
- OnParametersSet used for mode detection because Blazor reuses component instances during SPA navigation -- OnInitializedAsync does NOT re-fire when route parameters change
- Default parameter value `null` on statusFilter ensures all existing callers compile without modification (backward compatible)
- No route constraint needed on Mode parameter -- string vs :int constraint on ActivityDetail naturally disambiguates

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness
- Phase 3.1 fully complete: navigation config service (Plan 01) + activity list modes (Plan 02) both delivered
- Activity list now matches legacy WebForms behavior with 3 status modes accessible via Row 2 tabs
- Ready for Phase 4 (write operations) or any future phases requiring filtered list views

## Self-Check: PASSED

All 4 modified files verified present. Both task commits (dbe295c, 0b585ce) verified in git log.

---
*Phase: 03.1-route-aware-nav-activity-modes*
*Completed: 2026-02-16*
