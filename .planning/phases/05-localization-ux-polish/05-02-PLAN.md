---
phase: 05-localization-ux-polish
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/SignaturPortal.Web/Services/DbMudLocalizer.cs
  - src/SignaturPortal.Web/Components/Pages/Activities/ActivityList.razor
  - src/SignaturPortal.Web/Components/Pages/Activities/ActivityList.razor.cs
  - src/SignaturPortal.Web/Components/Pages/Activities/ActivityDetail.razor
  - src/SignaturPortal.Web/Components/Pages/Activities/ActivityDetail.razor.cs
  - src/SignaturPortal.Web/Components/Pages/Activities/CandidateList.razor
  - src/SignaturPortal.Web/Components/Pages/Activities/CandidateList.razor.cs
  - src/SignaturPortal.Web/Components/Pages/Activities/CandidateDetail.razor
  - src/SignaturPortal.Web/Components/Pages/Activities/CandidateDetail.razor.cs
  - src/SignaturPortal.Web/Components/Layout/NavMenu.razor
  - src/SignaturPortal.Web/Program.cs
autonomous: true

must_haves:
  truths:
    - "All visible UI text in existing pages uses IStringLocalizer keys instead of hardcoded English"
    - "MudBlazor built-in component strings (data grid pager, filter labels) are localized via DbMudLocalizer"
    - "Navigation menu labels use localized strings"
    - "Status names, column headers, and button labels are all localized"
  artifacts:
    - path: "src/SignaturPortal.Web/Services/DbMudLocalizer.cs"
      provides: "MudBlazor internal localization bridge to DB-backed localizer"
      contains: "class DbMudLocalizer"
    - path: "src/SignaturPortal.Web/Components/Pages/Activities/ActivityList.razor"
      provides: "Activity list page with localized column headers and labels"
      contains: "@inject IStringLocalizer"
  key_links:
    - from: "src/SignaturPortal.Web/Services/DbMudLocalizer.cs"
      to: "IStringLocalizer"
      via: "delegates to DB-backed string localizer"
      pattern: "_localizer\\["
    - from: "src/SignaturPortal.Web/Components/Pages/Activities/ActivityList.razor"
      to: "IStringLocalizer"
      via: "inject and use for all UI text"
      pattern: "@Loc\\["
---

<objective>
Localize all existing UI pages (activity list, activity detail, candidate list, candidate detail, nav menu) by replacing hardcoded English strings with IStringLocalizer lookups. Create the MudBlazor localization bridge so built-in component strings (data grid pagination, filter labels) are also localized.

Purpose: After Plan 01 built the localization infrastructure, this plan wires it into every user-facing component. Users selecting Danish will see all UI text in Danish, matching the legacy WebForms experience.

Output: All existing pages display localized text. MudBlazor components display localized built-in strings.
</objective>

<execution_context>
@C:/Users/it/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/it/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-localization-ux-polish/05-RESEARCH.md
@.planning/phases/05-localization-ux-polish/05-01-SUMMARY.md
@src/SignaturPortal.Web/Components/Pages/Activities/ActivityList.razor
@src/SignaturPortal.Web/Components/Pages/Activities/ActivityList.razor.cs
@src/SignaturPortal.Web/Components/Pages/Activities/ActivityDetail.razor
@src/SignaturPortal.Web/Components/Pages/Activities/ActivityDetail.razor.cs
@src/SignaturPortal.Web/Components/Pages/Activities/CandidateList.razor
@src/SignaturPortal.Web/Components/Pages/Activities/CandidateList.razor.cs
@src/SignaturPortal.Web/Components/Pages/Activities/CandidateDetail.razor
@src/SignaturPortal.Web/Components/Pages/Activities/CandidateDetail.razor.cs
@src/SignaturPortal.Web/Components/Layout/NavMenu.razor
@src/SignaturPortal.Web/Program.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: MudBlazor localization bridge and DI registration</name>
  <files>
    src/SignaturPortal.Web/Services/DbMudLocalizer.cs
    src/SignaturPortal.Web/Program.cs
  </files>
  <action>
    1. Create `src/SignaturPortal.Web/Services/DbMudLocalizer.cs`:
       - `internal class DbMudLocalizer : MudLocalizer`
       - Constructor takes `IStringLocalizer<DbMudLocalizer> localizer` (generic form triggers factory)
       - Override `this[string key]`: Delegate to `_localizer[key]`. If the result is `ResourceNotFound`, return the key as-is (MudBlazor keys like "MudDataGrid.Contains" may not exist in the legacy DB -- fall through gracefully instead of showing "N/A")
       - Override `this[string key, params object[] arguments]`: Same delegation with format args

    2. Update `src/SignaturPortal.Web/Program.cs`:
       - Add `builder.Services.AddTransient<MudLocalizer, DbMudLocalizer>();` after existing `AddMudServices()` call
       - Add necessary using statement for `MudBlazor` namespace
  </action>
  <verify>
    Run `dotnet build src/SignaturPortal.Web/SignaturPortal.Web.csproj` -- must compile.
  </verify>
  <done>
    MudBlazor built-in component strings (data grid pager text, filter labels, etc.) are routed through the DB-backed localizer. Missing MudBlazor keys fall back to the English default gracefully.
  </done>
</task>

<task type="auto">
  <name>Task 2: Localize all existing pages and navigation</name>
  <files>
    src/SignaturPortal.Web/Components/Pages/Activities/ActivityList.razor
    src/SignaturPortal.Web/Components/Pages/Activities/ActivityList.razor.cs
    src/SignaturPortal.Web/Components/Pages/Activities/ActivityDetail.razor
    src/SignaturPortal.Web/Components/Pages/Activities/ActivityDetail.razor.cs
    src/SignaturPortal.Web/Components/Pages/Activities/CandidateList.razor
    src/SignaturPortal.Web/Components/Pages/Activities/CandidateList.razor.cs
    src/SignaturPortal.Web/Components/Pages/Activities/CandidateDetail.razor
    src/SignaturPortal.Web/Components/Pages/Activities/CandidateDetail.razor.cs
    src/SignaturPortal.Web/Components/Layout/NavMenu.razor
  </files>
  <action>
    For EACH page/component file listed:

    1. Add `@inject IStringLocalizer<ComponentName> Loc` to the .razor file (or `[Inject] private IStringLocalizer<ComponentName> Loc { get; set; } = default!;` in the .razor.cs code-behind)

    2. Replace ALL hardcoded English strings with `@Loc["KeyName"]` calls. Use the SAME key patterns as the legacy app where known. Common keys from the legacy Localization table:
       - Activity List: "Activity" (column header), "JournalNo", "Deadline", "Status", "Candidates", "RecruitmentActivities" (page title), "NoActiveSearch" (empty state), "All", "OnGoing", "Closed", "Draft"
       - Activity Detail: "ActivityDetails", "Headline", "Jobtitle", "Department", "HireDate", "HiringTeam", "Responsible", "CreatedBy", "Members"
       - Candidate List: "Candidates", "Name", "Email", "ApplicationDate", "CandidateStatus"
       - Candidate Detail: "CandidateDetails", "FirstName", "LastName", "Telephone", "Address", "City", "ZipCode", "Documents", "Download", "CV", "ApplicationLetter"
       - Nav Menu: Labels for menu items (these may already be data-driven from legacy; localize only hardcoded strings)

    3. For status name strings that are currently resolved via StatusMappings helper (in-memory after EF query), keep the StatusMappings approach but make StatusMappings return localization keys instead of English strings, then resolve via IStringLocalizer. If StatusMappings is already hardcoded English, replace with `Loc["StatusOnGoing"]`, `Loc["StatusClosed"]`, etc.

    4. For any string that uses format placeholders (e.g., "Showing {0} of {1} candidates"), use `@Loc["ShowingXOfY", count, total]` pattern.

    5. Add `@using Microsoft.Extensions.Localization` to `_Imports.razor` if not already present, so all components can use IStringLocalizer without per-file using statements.

    NOTE: The exact localization keys MUST match what exists in the Localization table. Read the existing pages first to identify every hardcoded string. If a key is uncertain, use a reasonable English key name -- the DbStringLocalizer will fall back to the key itself if not found in DB, which is acceptable for Phase 5 (keys can be added to the DB later).
  </action>
  <verify>
    Run `dotnet build` from solution root -- must compile. Grep all .razor and .razor.cs files in Activities/ and Layout/ for remaining hardcoded English user-facing strings (excluding technical strings like route attributes, CSS classes, etc.). There should be none.
  </verify>
  <done>
    All user-facing text in ActivityList, ActivityDetail, CandidateList, CandidateDetail, and NavMenu uses IStringLocalizer. A Danish user will see Danish text from the Localization table. An English user will see English text. MudBlazor component strings are also routed through the localizer.
  </done>
</task>

</tasks>

<verification>
- `dotnet build` compiles with zero errors
- Every .razor file in Activities/ has `@inject IStringLocalizer` or code-behind equivalent
- No hardcoded English user-facing strings remain in activity pages
- DbMudLocalizer is registered and delegates to DB-backed localizer
- `_Imports.razor` includes `Microsoft.Extensions.Localization` using
</verification>

<success_criteria>
- All existing pages display localized text via IStringLocalizer
- MudBlazor built-in strings (pagination, filters) are localized
- Navigation menu labels are localized
- Format string placeholders work correctly
- Missing keys fall back gracefully (show key name, not crash)
</success_criteria>

<output>
After completion, create `.planning/phases/05-localization-ux-polish/05-02-SUMMARY.md`
</output>
